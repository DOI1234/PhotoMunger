![Icon](image0.png) PhotoMunger
===

Introduction
---
PhotoMunger is a tool that applies batch processing to a set of photos. I wrote PhotoMunger to solve two specific problems I had: 1) reducing the size of images, but only when down-scaling will not appreciably lose detail, and 2) enhancing document "scans" made with a point-and-shoot camera in lieu of a proper scanner.

Please note that as a result of this focused purpose there are a number of things that PhotoMunger *won't* do, including most of the various filters found in programs like [GIMP][1] or [Photoshop][2].

PhotoMunger is open source and is licensed under the GPL (GNU Public License). The source can be found on GitHub [here][5].

Outline of Typical Workflow
---
PhotoMunger processes all photos in one directory. The program can be launched in two ways. First, the directory to process can be specified on the command line: `PhotoMunger.exe <path>`. Or, if the program is launched with no arguments, it will prompt for the directory to process. Navigate *into* the directory to process and press *Open*.

The program then presents a dialog with various processing options. Which options to select depends on the task at hand. See sections later in this document for information about how to use these settings.

After the options dialog is accepted by pressing *OK*, the main window appears and the program begins analysis of the photos. Depending on the selected options, analysis may take more or less time.

![Main Window](image1.jpg)

There are 5 primary areas in the display:

1. A list of all items in the directory. The text of each entry is gray until it has been processed, at which point it turns black. ~~Struck through~~ text indicates that the file was not recognized as a supported image type (in general, only the *JPEG/EXIF* format is supported). Images and options can be selected by clicking on the appropriate row or using the cursor keys to navigate the active cell to a different row or column. If the active cell contains a check box, the space bar will toggle between checked and unchecked. There are also a couple of options for easy access:
	- *Shrink*: when checked, causes the file to be down-scaled by the specified ratio (the default is 2, which cuts both the width and height in half, resulting an an image that is approximately one-quarter the size of the original).
	- *Delete*: when checked, the file will be omitted from the final generated output (after *Apply* is pressed).
2. A primary display of the current image. This rendition may or may not show annotations depending on options enabled on the toolbar.
3. A toolbar for enabling display options and performing certain transformations on the image.
4. A side-by-side display of the portion of the image under the mouse, zoomed in to full scale. The upper frame shows the original image and the lower frame shows the image after it has been *shrunk* by the shrink ratio (default is 2) and then *expanded* to the original size by a high-quality resize algorithm. This area can be used to inspect parts of the image to determine how much quality might be lost given the proposed transformation.
5. An image status area. Some basic statistics are shown here, including the width and height of the original image, the width and height of the image after cropping and down-scaling is applied, the original file size and estimated final file size for the image, check boxes to enable specific transformations, and an area where messages may be displayed if an analysis pass for one of the automatic transformations was unable to determine how to process the image.

Typically, one will inspect all of the images to determine if the automatic transformations are acceptable. If automatic detection did not work as desired, specific changes can be made to an image to improve the result.

After image transformations have been checked and possibly modified, the output is generated by pressing *Apply* on the toolbar. If this is the first time a directory has been processed, a backup of all files is made. The files are copied to a directory in the same location with same name, but with `-original` appended. Each image is then processed and the resulting output stored in the selected directory.

The program saves a `Settings.xml` file in the selected directory (or in the backup directory, if it exists) containing the transformation settings and user interface options for the photo collection so that when the program is closed and reopened the options and per-image transformations will be remembered.

Workflow 1: Reducing Image Size
---
To work on image size reduction for a photo collection, accept the defaults in the options dialog by pressing *OK*. The main window will appear and the program will begin analysis of the photos.

By default, the program displays the result of an analysis that identifies regions of an image that contain a high degree of detail that would be lost if the image is *shrunk* (down-scaled) by a factor of 2. These areas are highlighted by a mesh of yellow boxes. The computation is tuned to detect the degree of loss that a typical person might notice, but it is approximate. For important images, move the mouse over critical areas and use the side-by-side inspection panel to see how much detail would be lost.

![Inspecting an image for loss of detail](image2.jpg)

In this example, the left panel shows the yellow mesh identifying an automatically-detected area of high detail and the right panel shows the side-by-side zoomed-in view showing the loss of fine detail should the image be shrunk.

Cropping
---
PhotoMunger supports lossless JPEG cropping via [`jpegtran.exe`][3]. To crop an image, first enable the cropping tool by making sure the crop button is enabled on the toolbar:
![Crop tool](image3.png)

Once the crop tool is enabled, clicking and dragging anywhere in the image will create a crop rectangle. The portion of the image inside the rectangle will be retained and that outside will be discarded. An existing crop rectangle can be modified by clicking and dragging on the pads at the corners or in the middle of each side of the rectangle. The crop rectangle can be moved without changing it's side by clicking and dragging on the pad in the rectangle's center.

The crop region can be cleared by clicking the clear crop button:
![Clear crop region](image4.png)

###Aspect ratio:

The aspect ratio of the crop rectangle can be constrained. By default, the aspect ratio is made to match the aspect ratio of the overall image.
![Constrain crop aspect ratio](image5.png)

To flip the aspect ratio relative to the overall image's aspect ratio, select the flip button. The aspect ratio remains the same, but for *landscape*-oriented images the crop rectangle will be *portrait*-oriented, and vice versa.
![Flip crop aspect ratio](image6.png)

To select a specific aspect ratio (for example, for targeting a specific shape for making prints), click the preset/custom aspect ratio button to open a dialog allowing the aspect ratio to be chosen. In addition to common print/page shapes it is possible to enter the width and height for a custom aspect ratio.
![Custom aspect ratio](image7.png)

Workflow 2: Enhancing Images "Scanned" via Point-and-Shoot Camera
---


---
[1]: http://www.gimp.org/
[2]: http://www.adobe.com/products/photoshop.html
[3]: http://jpegclub.org/
[4]: https://stackedit.io/editor
[5]: https://github.com/programmatom/PhotoMunger

Last updated September 2016. Authored using [stackedit][2].

